#!/bin/sh

run () {
    ssh -o StrictHostKeyChecking=no -o UserKnownHostsFile=/dev/null -o KbdInteractiveAuthentication=no -o PasswordAuthentication=no -tt -i {{ hostvars["jumpbox"]["ansible_ssh_private_key_file"] }} centos@{{ hostvars["jumpbox"]["ansible_ssh_host"] }} $*
}

run "sudo journalctl -ef -u dci-agent& sudo systemctl start dci-agent"
run "sudo systemctl is-failed dci-agent" |grep failed && exit 1
